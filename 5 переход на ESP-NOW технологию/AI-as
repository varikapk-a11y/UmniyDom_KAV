Техническое задание для AI-ассистента по отладке проекта ESP-NOW хаба на PlatformIO

Проект: ESP32-Hub (управляющее устройство). Цель: Веб-интерфейс + ESP-NOW для управления удалённым узлом (ESP32-C3).

1. Текущее состояние проекта:

Код: Имеется рабочий, исправленный скетч для Arduino IDE, успешно управляющий узлом. Код адаптирован под новое API ESP-NOW (использует esp_now_send_info_t и esp_now_recv_info_t).

Проблема: Перенос проекта в PlatformIO вызывает непрерывные ошибки сборки, связанные с конфликтом и автоматической установкой несовместимых библиотек.

2. Конкретные ошибки, которые необходимо устранить:

Конфликт библиотек веб-серверов: ESP Async WebServer (нужная, асинхронная) vs WebServer (ненужная, стандартная синхронная). Система LDF (Library Dependency Finder) постоянно подтягивает WebServer, что приводит к фатальной ошибке fatal error: WiFiServer.h: No such file or directory.

Установка несовместимых библиотек: PlatformIO устанавливает AsyncTCP_RP2040W (для Raspberry Pi Pico W) вместо ESP32 Async TCP или AsyncTCP для ESP32. Это вызывает ошибку компиляции #error For RASPBERRY_PI_PICO_W board using CYW43439 WiFi only.

Сбои в работе LDF: Настройки lib_ldf_mode (как chain+) нарушают порядок поиска заголовочных файлов, что может быть причиной ошибок с базовыми библиотеками (WiFi.h, WiFiServer.h).

3. Требования к конечному решению:

Код: Должен остаться функционально идентичным исходному рабочему скетчу. Меняем только способ подключения библиотек и структуру проекта.

Конфигурация PlatformIO (platformio.ini): Должна гарантировать установку только следующих совместимых библиотек и их версий:

ini
lib_deps =
    ESP Async WebServer  # Асинхронный веб-сервер
    AsyncTCP             # Зависимость для ESP32 (НЕ AsyncTCP_RP2040W!)
    bblanchon/ArduinoJson @ 6.21.3 # Версия 6.x, так как код под неё написан
Настройки lib_ldf_mode должны быть удалены или установлены в безопасный режим.

Структура проекта: Библиотеки должны управляться исключительно через lib_deps в platformio.ini. В папке src/ не должно быть никаких исходных файлов библиотек (.cpp, .h).

4. Задача для ассистента:

Провести анализ: Проанализировать текущий код из папки src/ и файл platformio.ini на предмет причин, по которым LDF подтягивает лишние библиотеки (WebServer, AsyncTCP_RP2040W).

Предложить исправления:

Для кода: Убрать возможные лишние или конфликтующие директивы #include. Убедиться, что используется только #include <ESPAsyncWebServer.h>.

Для platformio.ini: Предоставить финальную, рабочую конфигурацию, которая жёстко задаёт нужные библиотеки и предотвращает установку конфликтующих.

Для структуры: Дать команды для полной очистки кеша проекта (pio run --target clean и удаление .pio/libdeps/) и инструкцию по созданию нового "чистого" проекта как крайнюю меру.

Предоставить итог: Чёткий пошаговый план (чек-лист) действий пользователя для получения стабильно собирающегося проекта.

5. Критерий успеха: После выполнения всех шагов плана команда pio run (Build) в PlatformIO выполняется без ошибок от начала до конца, а в выводе терминала видна установка только указанных в lib_deps библиотек.
